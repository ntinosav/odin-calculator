<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Calculator</title>
</head>
<body>





<div id="calc">
    <div id="screen">Numbers</div>
    <div class="row">
        <div class="button">7</div>
        <div class="button">8</div>
        <div class="button">9</div>
        <div class="button operator">+</div>
    </div>
    <div class="row">
        <div class="button">4</div>
        <div class="button">5</div>
        <div class="button">6</div>
        <div class="button operator">-</div>
    </div>
    <div class="row">
        <div class="button">1</div>
        <div class="button">2</div>
        <div class="button">3</div>
        <div class="button operator">*</div>
    </div>
    <div class="row">
        <div class="button">0</div>
        <div class="button operator">.</div>
        <div class="button operator">=</div>
        <div class="button operator">/</div>
    </div>
    <div class="row">
        <div class="button" id="clear">Clear</div>
    </div>
    <div class="row">
        <div class="button" id="bspace">Backspace</div>
    </div>

</div>










    <script>
        let num1 = undefined;
        let temp1 = '';
        let num2 = undefined;
        let temp2 = '';
        let oper = undefined;
        let prev_oper = false;
        let prev_equal = false;
        let needsClear = false;
        const operators = document.querySelectorAll(".operator");
        const ops = Array.from(operators);
        const clearButton = document.getElementById('clear');

        const buttons = document.querySelectorAll(".button");

        function add(a,b){
            return a+b;
        }

        function subtract(a,b){
            return a-b;
        }

        function multiply(a,b){
            return a*b;
        }

        function divide(a,b){
            if (b !== 0){
                return a/b;
            }else{
                return 'Nice try';
            }
            
        }

        function operate(op, a, b){
            let res =0;
            if (op == '+'){
                res = add(a,b);
            }else if (op == '-'){
                res = subtract(a,b);
            }else if (op == '*'){
                res = multiply(a,b);
            }else if (op == '/'){
                res = divide(a,b);
            }
            return res;
        }



        let scr = document.getElementById("screen");
   
        scr.textContent = operate(oper, num1, num2);

        buttons.forEach((btn) => {
            btn.addEventListener("click", () => {
                if ((! isNaN(btn.textContent) || btn.textContent == '.' || btn.textContent == 'Backspace') && needsClear==false){
                    prev_oper = false;
                    prev_equal = false;
                    if (btn.textContent != 'Backspace'){
                        if (num1 == undefined){
                        if (!temp1.includes('.') || btn.textContent!= '.'){
                            temp1 += btn.textContent;
                            scr.textContent = temp1;
                            console.log(temp1);
                        }
                        
                    }else if (num2 == undefined){
                        if (!temp2.includes('.') || btn.textContent != '.'){
                            temp2 += btn.textContent;
                            scr.textContent = temp2;
                            console.log(temp2);
                        }
                    }
                }else{
                     if (temp2 != ''){
                         // temp2 = String(num2);
                         if (temp2.length > 1) {
                             temp2 = temp2.slice(0,-1);
                         }
                         scr.textContent = temp2;
                        }else if (temp1 != ''){
                            if (num1 != undefined){
                                 temp1 = String(num1);
                            }
                           
                            if (temp1.length > 1) {
                                temp1 = temp1.slice(0,-1);
                                console.log(temp1);
                            }
                            scr.textContent = temp1;
                        }

                }
                   
            }else{
                        console.log("Hello");
                  
                            // btn.style.backgroundColor = 'red';
                        if (temp1 != ''){
                            num1 = parseFloat(temp1);
                            if (parseInt(temp1) == num1) {
                                num1 = parseInt(temp1);
                            }
                            temp1= '';
                        }else if (temp2 != ''){
                            num2 = parseFloat(temp2);
                            if (parseInt(temp2) == num2) {
                                num2 = parseInt(temp2);
                            }
                            temp2 = '';
                        }


                        if(btn.textContent == 'Clear'){
                            num1 = undefined;
                            temp1 = '';
                            num2 = undefined;
                            temp2 = '';
                            oper = undefined;
                            res = undefined;
                            scr.textContent = 0;
                            ops.forEach((item)=> {item.style.backgroundColor = 'bisque';} );
                            btn.style.backgroundColor = 'white';
                            needsClear = false;
                        }
                    
                    if ((needsClear/*prev_oper  && num2 == undefined */ && btn.textContent != 'Clear')){
                        scr.textContent = 'Error. Press Clear';
                        ops.forEach((item)=> {item.style.backgroundColor = 'red';} );
                        clearButton.style.backgroundColor = '#00ff00';
                        needsClear = true;

                    }else{
                    
                            if (!needsClear){
                                if(btn.textContent == '='){
                                    if (!prev_equal && num2!=undefined){
                                        res = operate(oper,num1,num2);
                                        scr.textContent = res;
                                        num1 = res ;
                                        num2 = undefined;
                                        temp2 = '';
                                        oper = undefined;
                                        prev_equal = true;
                                        if (res == 'Nice try'){
                                            scr.textContent = 'Nice try';
                                            ops.forEach((item)=> {item.style.backgroundColor = 'red';} );
                                            clearButton.style.backgroundColor = '#00ff00';
                                            needsClear = true;
                                        }
                                    }

                                    ops.forEach((item)=> {item.style.backgroundColor = 'bisque';} );
                                    btn.style.backgroundColor = 'red';
                                
                                }else if (oper == undefined){
                                    prev_equal = false;
                                    oper = btn.textContent;
                                    prev_oper = true;
                                    console.log("Operation :" + oper);
                                    ops.forEach((item)=> {item.style.backgroundColor = 'bisque';} );
                                    btn.style.backgroundColor = 'red';

                                }else{
                                    // alert("Wrong !");
                                    prev_equal = false;
                                    res = operate(oper,num1,num2);
                                    scr.textContent = res;
                                    num1 = res ;
                                    num2 = undefined;
                                    temp2 = '';
                                    oper = btn.textContent;
                                    prev_oper = true;
                                    ops.forEach((item)=> {item.style.backgroundColor = 'bisque';} );
                                    btn.style.backgroundColor = 'red';
                                    if (res == 'Nice try'){
                                            scr.textContent = 'Nice try';
                                            ops.forEach((item)=> {item.style.backgroundColor = 'red';} );
                                            clearButton.style.backgroundColor = '#00ff00';
                                            needsClear = true;
                                        }
                                }
                            }
                        } 
                    }
                    
                    
                    
            }
        )});
        
    </script>
</body>
</html>